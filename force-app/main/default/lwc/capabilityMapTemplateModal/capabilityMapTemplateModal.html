<template>
    <div class="modal-overlay" onclick={handleOverlayClick}>
        <div class="modal wide" onclick={stopPropagation}>
            <!-- Header - Blue gradient like mockup -->
            <div class="modal-header blue">
                <div>
                    <div class="modal-title">‚òÅÔ∏è Salesforce Cloud Templates</div>
                    <div class="modal-subtitle">All capabilities start as TBD - you assign the sizing</div>
                </div>
                <button class="close-btn" onclick={handleClose}>‚úï</button>
            </div>
            
            <!-- Body -->
            <div class="modal-body">
                <template if:true={isLoading}>
                    <div class="loading-spinner">
                        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
                    </div>
                </template>
                
                <template if:false={isLoading}>
                    <!-- Category Tabs -->
                    <div class="template-tabs">
                        <template for:each={templateCategories} for:item="cat">
                            <button key={cat.name} class={cat.tabClass} data-category={cat.name} onclick={handleCategoryClick}>
                                {cat.name}
                            </button>
                        </template>
                    </div>
                    
                    <!-- Template Grid -->
                    <div class="template-grid">
                        <template for:each={filteredTemplates} for:item="template">
                            <div key={template.Id} class={template.cardClass} data-id={template.Id} onclick={handleTemplateSelect}>
                                <div class="template-icon">{template.Icon_Name__c}</div>
                                <div class="template-name">{template.Template_Name__c}</div>
                                <div class="template-desc">{template.Description__c}</div>
                                <div class="template-stats">
                                    <span>üìÅ {template.categoryCount}</span>
                                    <span>üìã {template.capabilityCount}</span>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Preview Section -->
                    <template if:true={hasSelectedTemplate}>
                        <div class="template-preview">
                            <div class="preview-title">{selectedTemplateName} - Preview</div>
                            <div class="preview-categories">
                                <template for:each={previewCategories} for:item="category">
                                    <div key={category.Id} class="preview-category">
                                        <div class="preview-category-name">
                                            <template if:true={category.Is_Subcategory__c}>‚Ü≥ </template>
                                            {category.Name}
                                        </div>
                                        <div class="preview-caps">
                                            <template for:each={category.items} for:item="item">
                                                <div key={item.Id} class="preview-cap">{item.Name}</div>
                                            </template>
                                            <template if:true={category.hasMore}>
                                                <div class="preview-cap more">+{category.moreCount} more</div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </template>
            </div>
            
            <!-- Footer -->
            <div class="modal-footer">
                <button class="btn" onclick={handleClose}>Cancel</button>
                <button class="btn orange" onclick={handleApply} disabled={applyDisabled}>
                    Apply Template
                </button>
            </div>
        </div>
    </div>
</template>
